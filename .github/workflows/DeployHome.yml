name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  deploy:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    environment: home
    
    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - run: sudo apt install wireguard

      - run: echo "${{ secrets.PRIVATE }}" > privatekey

      - run: sudo ip link add dev wg0 type wireguard

      - run: sudo ip address add dev wg0  ${{ vars.IPS }}
    

      - run: sudo wg set wg0 listen-port ${{ vars.PORT }} private-key privatekey peer ${{ vars.PUBLIC_CERT }} allowed-ips ${{ vars.ALLOWED_IPS }} endpoint ${{ secrets.ENDPOINT }}

      - run: sudo ip link set up dev wg0

      - run: curl ifconfig.me

      - run: sudo ip link

      - run: sudo wg
      - run: wg showconf wg0